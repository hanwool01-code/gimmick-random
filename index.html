<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ë¯¹ ëœë¤ ì¡°í•©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            padding: 40px 20px;
            text-align: center;
            background: #ffffff;
        }
        
        h1 {
            color: #004B3E;
            margin-bottom: 40px;
            font-size: 42px;
        }
        
        /* ì œì™¸ íŒ¨ë„ */
        .exclude-panel {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin: 0 auto 40px;
            max-width: 900px;
            border: 2px solid #e5e5e5;
            text-align: left;
        }
        
        .exclude-title {
            font-size: 20px;
            font-weight: bold;
            color: #004B3E;
            margin-bottom: 10px;
        }
        
        .exclude-subtitle {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
        }
        
        .category-section {
            margin-bottom: 20px;
        }
        
        .category-name {
            font-size: 16px;
            font-weight: 600;
            color: #004B3E;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            display: inline-block;
        }
        
        .gimmick-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .gimmick-checkbox {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .gimmick-checkbox:hover {
            border-color: #004B3E;
            background: #f0f5f4;
        }
        
        .gimmick-checkbox input {
            margin-right: 8px;
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        
        .gimmick-checkbox.excluded {
            background: #ffe5e5;
            border-color: #ff6b6b;
            color: #999;
            text-decoration: line-through;
        }
        
        .exclude-controls {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 10px 20px;
            background: white;
            color: #666;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            border-color: #004B3E;
            color: #004B3E;
        }
        
        .exclude-count {
            padding: 10px 20px;
            background: #004B3E;
            color: white;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }
        
        /* ë²„íŠ¼ */
        button.generate-btn {
            padding: 18px 60px;
            background: #004B3E;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s;
        }
        
        button.generate-btn:hover {
            background: #003529;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 75, 62, 0.2);
        }
        
        button.generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ê²°ê³¼ */
        #result {
            margin-top: 30px;
        }
        
        .result-card {
            background: #f0f5f4;
            padding: 20px;
            margin: 15px auto;
            max-width: 400px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .result-category {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .result-gimmick {
            font-size: 20px;
            font-weight: bold;
            color: #004B3E;
        }
        
        .result-stats {
            margin-top: 30px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .warning {
            color: #FF6B6B;
            padding: 30px;
            font-size: 18px;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }
            
            .gimmick-grid {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            }
            
            .exclude-panel {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸ® ê¸°ë¯¹ ëœë¤ ì¡°í•©</h1>
    
    <!-- ì œì™¸ íŒ¨ë„ -->
    <div class="exclude-panel">
        <div class="exclude-title">ğŸš« ì œì™¸í•  ê¸°ë¯¹ ì„ íƒ</div>
        <div class="exclude-subtitle">ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ì—¬ íŠ¹ì • ê¸°ë¯¹ì„ ëœë¤ ì¡°í•©ì—ì„œ ì œì™¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
        
        <div class="category-section">
            <div class="category-name">â­ 1í¬ì¸íŠ¸ ê¸°ë¯¹</div>
            <div class="gimmick-grid" id="point1Grid"></div>
        </div>
        
        <div class="category-section">
            <div class="category-name">â­â­ 2í¬ì¸íŠ¸ ê¸°ë¯¹</div>
            <div class="gimmick-grid" id="point2Grid"></div>
        </div>
        
        <div class="category-section">
            <div class="category-name">ğŸ“¦ ì¼ë°˜ ê¸°ë¯¹</div>
            <div class="gimmick-grid" id="normalGrid"></div>
        </div>
        
        <div class="exclude-controls">
            <button class="control-btn" onclick="selectAll()">ì „ì²´ ì„ íƒ</button>
            <button class="control-btn" onclick="deselectAll()">ì „ì²´ í•´ì œ</button>
            <div class="exclude-count">
                ì œì™¸ëœ ê¸°ë¯¹: <span id="excludeCount">0</span>ê°œ
            </div>
        </div>
    </div>
    
    <!-- ìƒì„± ë²„íŠ¼ -->
    <button class="generate-btn" onclick="generateRandom()">ìƒˆë¡œ ë½‘ê¸°</button>
    
    <!-- ê²°ê³¼ ì˜ì—­ -->
    <div id="result"></div>
    
    <script>
        // ê¸°ë¯¹ ë°ì´í„°
        const GIMMICKS = {
            point1: [
                'ì˜¤ë¸', 'í† ë¼í’€í™”ë‹¨', 'ë¸”ë¡ë°•ìŠ¤í­íƒ„', 'ì»¬ëŸ¬ë°•ìŠ¤', 
                'í”Œë¼ìŠ¤í¬', 'ë…¸ì´', 'ë©”ëª¨íŒ', 'ìº¡ìŠì˜¤ë¦¬ë°•ìŠ¤', 
                'ê³°ì¸í˜•ìƒì', 'ì‚¬íƒ•ë³‘', 'ì–‘í„¸'
            ],
            point2: [
                'ë²„ë¸”ê½ƒ', 'í­íƒ„ì£¼ë¨¸ë‹ˆ', 'ì–‘í„¸ë°”êµ¬ë‹ˆ', 'ë²½ëŒ', 
                'ì˜¤ë¡œë¼ë²„ë¸”ê½ƒ', 'ë¨í”„', 'ì‚¬ë¬¼í•¨', 'ë¶„í™ê½ƒí™”ë¶„', 
                'ë¶„í™ì”ë””', 'ìº¡ìŠì˜¤ë¦¬'
            ],
            normal: [
                'íƒë°°ë°•ìŠ¤', 'ì»µ', 'ì”ë””', 'í´ë¡œë²„ì„ìƒ', 
                'ì‚¬ê³¼', 'ì¹´í«', 'ë°¤', 'ì§„ì£¼ì¡°ê°œ', 'ì„íŒ'
            ]
        };
        
        // ì œì™¸ëœ ê¸°ë¯¹ ì €ì¥
        let excludedGimmicks = new Set();
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²´í¬ë°•ìŠ¤ ìƒì„±
        window.addEventListener('DOMContentLoaded', () => {
            initializeCheckboxes();
        });
        
        // ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
        function initializeCheckboxes() {
            createCheckboxes('point1Grid', GIMMICKS.point1);
            createCheckboxes('point2Grid', GIMMICKS.point2);
            createCheckboxes('normalGrid', GIMMICKS.normal);
        }
        
        // ì²´í¬ë°•ìŠ¤ ìƒì„±
        function createCheckboxes(gridId, gimmicks) {
            const grid = document.getElementById(gridId);
            gimmicks.forEach(gimmick => {
                const label = document.createElement('label');
                label.className = 'gimmick-checkbox';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = gimmick;
                checkbox.onchange = (e) => toggleExclude(gimmick, e.target.checked, label);
                
                const text = document.createElement('span');
                text.textContent = gimmick;
                
                label.appendChild(checkbox);
                label.appendChild(text);
                grid.appendChild(label);
            });
        }
        
        // ì œì™¸ í† ê¸€
        function toggleExclude(gimmick, isChecked, label) {
            if (isChecked) {
                excludedGimmicks.add(gimmick);
                label.classList.add('excluded');
            } else {
                excludedGimmicks.delete(gimmick);
                label.classList.remove('excluded');
            }
            updateExcludeCount();
        }
        
        // ì œì™¸ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateExcludeCount() {
            document.getElementById('excludeCount').textContent = excludedGimmicks.size;
        }
        
        // ì „ì²´ ì„ íƒ
        function selectAll() {
            document.querySelectorAll('.gimmick-checkbox input').forEach(checkbox => {
                if (!checkbox.checked) {
                    checkbox.checked = true;
                    const label = checkbox.closest('.gimmick-checkbox');
                    toggleExclude(checkbox.value, true, label);
                }
            });
        }
        
        // ì „ì²´ í•´ì œ
        function deselectAll() {
            document.querySelectorAll('.gimmick-checkbox input').forEach(checkbox => {
                if (checkbox.checked) {
                    checkbox.checked = false;
                    const label = checkbox.closest('.gimmick-checkbox');
                    toggleExclude(checkbox.value, false, label);
                }
            });
        }
        
        // ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ë¯¹ ê°€ì ¸ì˜¤ê¸°
        function getAvailableGimmicks() {
            const all = [...GIMMICKS.point1, ...GIMMICKS.point2, ...GIMMICKS.normal];
            return all.filter(g => !excludedGimmicks.has(g));
        }
        
        // ë°°ì—´ ì„ê¸°
        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
        
        // ì¶©ëŒ ê²€ì‚¬
        function canAddToCombo(combo, gimmick) {
            // ë²„ë¸” ê³„ì—´ ì¶©ëŒ
            const bubbles = ['í”Œë¼ìŠ¤í¬', 'ì˜¤ë¡œë¼ë²„ë¸”ê½ƒ', 'ë²„ë¸”ê½ƒ'];
            if (bubbles.includes(gimmick) && combo.some(g => bubbles.includes(g))) {
                return false;
            }
            
            // ë…¸ì´ â†” ìº¡ìŠì˜¤ë¦¬ë°•ìŠ¤
            if (gimmick === 'ë…¸ì´' && combo.includes('ìº¡ìŠì˜¤ë¦¬ë°•ìŠ¤')) return false;
            if (gimmick === 'ìº¡ìŠì˜¤ë¦¬ë°•ìŠ¤' && combo.includes('ë…¸ì´')) return false;
            
            // ìº¡ìŠì˜¤ë¦¬ â†” ìº¡ìŠì˜¤ë¦¬ë°•ìŠ¤
            if (gimmick === 'ìº¡ìŠì˜¤ë¦¬' && combo.includes('ìº¡ìŠì˜¤ë¦¬ë°•ìŠ¤')) return false;
            if (gimmick === 'ìº¡ìŠì˜¤ë¦¬ë°•ìŠ¤' && combo.includes('ìº¡ìŠì˜¤ë¦¬')) return false;
            
            // ì¹´í« ì¶©ëŒ
            const carpetIncompatible = ['ì”ë””', 'ë¶„í™ì”ë””', 'ë¶„í™ê½ƒí™”ë¶„', 'ì„íŒ', 'í† ë¼í’€í™”ë‹¨'];
            if (gimmick === 'ì¹´í«' && combo.some(g => carpetIncompatible.includes(g))) {
                return false;
            }
            if (carpetIncompatible.includes(gimmick) && combo.includes('ì¹´í«')) {
                return false;
            }
            
            // ë¶„í™ ê¸°ë¯¹ ì¶©ëŒ
            const pinkGimmicks = ['ë¶„í™ê½ƒí™”ë¶„', 'ë¶„í™ì”ë””'];
            const pinkIncompatible = ['ì¹´í«', 'ì”ë””', 'ì„íŒ'];
            if (pinkGimmicks.includes(gimmick) && combo.some(g => pinkIncompatible.includes(g))) {
                return false;
            }
            if (pinkIncompatible.includes(gimmick) && combo.some(g => pinkGimmicks.includes(g))) {
                return false;
            }
            
            return true;
        }
        
        // ì„¸íŠ¸ ê·œì¹™ ê²€ì‚¬
        function validateSetRules(combo) {
            // ë¶„í™ ì„¸íŠ¸
            const hasPinkFlower = combo.includes('ë¶„í™ê½ƒí™”ë¶„');
            const hasPinkGrass = combo.includes('ë¶„í™ì”ë””');
            if (hasPinkFlower !== hasPinkGrass) {
                return false;
            }
            
            // ì–‘í„¸ ì„¸íŠ¸
            const hasWoolBasket = combo.includes('ì–‘í„¸ë°”êµ¬ë‹ˆ');
            const hasWool = combo.includes('ì–‘í„¸');
            if (hasWoolBasket && !hasWool) {
                return false;
            }
            
            return true;
        }
        
        // ì¡°í•© ìƒì„± ì‹œë„
        function tryGenerateCombo(availableGimmicks) {
            const shuffled = shuffleArray(availableGimmicks);
            const combo = [];
            
            for (const gimmick of shuffled) {
                if (combo.length >= 4) break;
                if (canAddToCombo(combo, gimmick)) {
                    combo.push(gimmick);
                }
            }
            
            if (combo.length !== 4 || !validateSetRules(combo)) {
                return null;
            }
            
            return combo;
        }
        
        // ëœë¤ ìƒì„±
        function generateRandom() {
            const availableGimmicks = getAvailableGimmicks();
            
            // ê¸°ë¯¹ì´ ë¶€ì¡±í•œ ê²½ìš°
            if (availableGimmicks.length < 4) {
                document.getElementById('result').innerHTML = `
                    <div class="warning">
                        âš ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ë¯¹ì´ 4ê°œ ë¯¸ë§Œì…ë‹ˆë‹¤!<br>
                        ì œì™¸ ì„¤ì •ì„ ì¡°ì •í•´ì£¼ì„¸ìš”.
                    </div>
                `;
                return;
            }
            
            let result = null;
            let attempts = 0;
            const maxAttempts = 100;
            
            while (!result && attempts < maxAttempts) {
                result = tryGenerateCombo(availableGimmicks);
                attempts++;
            }
            
            if (result) {
                displayResult(result, attempts);
            } else {
                document.getElementById('result').innerHTML = `
                    <div class="warning">
                        âš ï¸ ì¡°í•© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>
                        ì œì™¸ëœ ê¸°ë¯¹ì´ ë„ˆë¬´ ë§ê±°ë‚˜ ì¡°í•© ê·œì¹™ìƒ ìƒì„±ì´ ì–´ë µìŠµë‹ˆë‹¤.<br>
                        (${maxAttempts}ë²ˆ ì‹œë„)
                    </div>
                `;
            }
        }
        
        // ê²°ê³¼ í‘œì‹œ
        function displayResult(result, attempts) {
            let html = '<h2>ğŸ² ë½‘íŒ ê¸°ë¯¹ ì¡°í•©</h2>';
            
            result.forEach((gimmick, index) => {
                let category = '';
                let color = '';
                
                if (GIMMICKS.point1.includes(gimmick)) {
                    category = 'â­ 1í¬ì¸íŠ¸';
                    color = '#FFD700';
                } else if (GIMMICKS.point2.includes(gimmick)) {
                    category = 'â­â­ 2í¬ì¸íŠ¸';
                    color = '#FF6B6B';
                } else {
                    category = 'ğŸ“¦ ì¼ë°˜';
                    color = '#4ECDC4';
                }
                
                html += `<div class="result-card" style="border-left: 5px solid ${color};">
                    <div class="result-category">${category}</div>
                    <div class="result-gimmick">${index + 1}. ${gimmick}</div>
                </div>`;
            });
            
            // í†µê³„
            const point1Count = result.filter(g => GIMMICKS.point1.includes(g)).length;
            const point2Count = result.filter(g => GIMMICKS.point2.includes(g)).length;
            const normalCount = result.filter(g => GIMMICKS.normal.includes(g)).length;
            
            html += `<div class="result-stats">
                <strong>ğŸ“Š ì¡°í•© ì •ë³´</strong><br>
                1í¬ì¸íŠ¸: ${point1Count}ê°œ | 
                2í¬ì¸íŠ¸: ${point2Count}ê°œ | 
                ì¼ë°˜: ${normalCount}ê°œ<br>
                <span style="color: #666; font-size: 13px;">
                    (${attempts}ë²ˆ ë§Œì— ìƒì„± ì™„ë£Œ)
                </span>
            </div>`;
            
            document.getElementById('result').innerHTML = html;
        }
    </script>
</body>
</html>